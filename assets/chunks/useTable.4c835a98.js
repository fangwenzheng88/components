import{i as b,b as x,a as f}from"./is.816509ab.js";import"./dayjs.min.1edc150c.js";import{u as g}from"./index.f8290869.js";import{h as i,y as D,x as I,a4 as w,a5 as h}from"./framework.f6b614a8.js";import{O as z,R as B}from"./index.ee9bd0d1.js";function A(e){return b(e)?e:x(e)?[e]:[]}const v=()=>({current:1,pageSize:10,total:0,showTotal:!0,showPageSize:!0});function T(e){const m=[...e.columns];if(e.operations){const a=e.operationsFixed===!1?void 0:e.operationsFixed??"right";m.push({title:"操作",dataIndex:"operation",fixed:a,render(o){const u=e.operations(o.record).filter(s=>s.visible!==!1);return h(B,{onResize:y},()=>h(z,{operations:u}))}})}const l=i(!1),r=i([]),t=g(m),n=i(!1);let c,p;(e.pagination===!0||f(e.pagination))&&(n.value=e.pagination===!0?v():{...v(),...e.pagination},c=a=>{n.value.current=a},p=a=>{n.value.current=1,n.value.pageSize=a}),D(()=>{if(n.value!==!1){const a=Array.isArray(r.value)?r.value.length:0;n.value.total=a}}),I(()=>f(n.value)?A(r.value).slice(n.value.pageSize*(n.value.current-1),n.value.pageSize*n.value.current):r.value??[],a=>{if(e.operations&&a.length>0){let o=!1;for(const u of a){const s=e.operations(u).filter(C=>C.visible!==!1);if(s&&s.length>0){o=!0;break}}t.changeColumnVisibleByDataIndex("operation",o)}});function y(a){const{width:o}=a.contentRect;t.updateColumnByDataIndex("operation","width",o+33)}function d(){if(l.value=!0,!e.fetch)throw new Error("useTable请提供fetch配置项");return e.fetch({columnKeys:[...t.columnKeys.value]}).then(a=>{r.value=Array.isArray(a)?a:[]}).finally(()=>{l.value=!1})}return e.immediate===!0&&d(),{tableData:r,loading:l,loadTableData:d,pagination:n,tableInstance:t.tableInstance,originColumns:t.originColumns,columns:t.columns,columnKeys:t.columnKeys,resetColumns:t.resetColumns,changeColumnVisibleByDataIndex:t.changeColumnVisibleByDataIndex,updateColumnByDataIndex:t.updateColumnByDataIndex,replaceColumnByDataIndex:t.replaceColumnByDataIndex,tableConfig:w({loading:l,data:r,columns:t.columns,ref:t.ref,pagination:n,onPageChange:c,onPageSizeChange:p,onColumnResize(a,o){t.updateColumnByDataIndex(a,"width",o),t.updateColumnsWidth()}})}}export{T as u};
