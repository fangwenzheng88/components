import{i as b,b as g,a as h}from"./is.816509ab.js";import"./use-popup-manager.89fcdf2b.js";import{u as D}from"./index.d6e2bb78.js";import{h as m,y as I,x as w,a4 as z,a5 as v}from"./framework.6989a421.js";import{O as B,R as A}from"./index.0215b6be.js";function S(e){return b(e)?e:g(e)?[e]:[]}const y=()=>({current:1,pageSize:10,total:0,showTotal:!0,showPageSize:!0});function W(e){const c=[...e.columns];if(e.operations){const a=e.operationsFixed===!1?void 0:e.operationsFixed??"right";c.push({title:"操作",dataIndex:"operation",fixed:a,render(o){const u=e.operations(o.record).filter(s=>s.visible!==!1);return v(A,{onResize:C},()=>v(B,{operations:u}))}})}const l=m(!1),r=m([]),t=D(c),n=m(!1);let p,d;(e.pagination===!0||h(e.pagination))&&(n.value=e.pagination===!0?y():{...y(),...e.pagination},p=a=>{n.value.current=a},d=a=>{n.value.current=1,n.value.pageSize=a}),I(()=>{if(n.value!==!1){const a=Array.isArray(r.value)?r.value.length:0;n.value.total=a}}),w(()=>h(n.value)?S(r.value).slice(n.value.pageSize*(n.value.current-1),n.value.pageSize*n.value.current):r.value??[],a=>{if(e.operations&&a.length>0){let o=!1;for(const u of a){const s=e.operations(u).filter(x=>x.visible!==!1);if(s&&s.length>0){o=!0;break}}t.changeColumnVisibleByDataIndex("operation",o)}});let i=80;function C(a){const{width:o}=a.contentRect;i=Math.max(o,i),t.updateColumnByDataIndex("operation","width",i+33)}function f(){if(l.value=!0,!e.fetch)throw new Error("useTable请提供fetch配置项");return e.fetch({columnKeys:[...t.columnKeys.value]}).then(a=>{r.value=Array.isArray(a)?a:[]}).finally(()=>{l.value=!1})}return e.immediate===!0&&f(),{tableData:r,loading:l,loadTableData:f,pagination:n,tableInstance:t.tableInstance,originColumns:t.originColumns,columns:t.columns,columnKeys:t.columnKeys,resetColumns:t.resetColumns,changeColumnVisibleByDataIndex:t.changeColumnVisibleByDataIndex,updateColumnByDataIndex:t.updateColumnByDataIndex,replaceColumnByDataIndex:t.replaceColumnByDataIndex,tableConfig:z({loading:l,data:r,columns:t.columns,ref:t.ref,pagination:n,onPageChange:p,onPageSizeChange:d,onColumnResize(a,o){t.updateColumnByDataIndex(a,"width",o),t.updateColumnsWidth()}})}}export{W as u};
