import{i as D,a as f}from"./is.816509ab.js";import"./use-popup-manager.89fcdf2b.js";import{u as I}from"./index.d6e2bb78.js";import{O as z,R as B}from"./index.0215b6be.js";import{h as c,x as w,a4 as P,a5 as h}from"./framework.6989a421.js";const C=()=>({current:1,pageSize:10,total:0,showTotal:!0,showPageSize:!0});function A(t){const p=[...t.columns];if(t.operations){const e=t.operationsFixed===!1?void 0:t.operationsFixed??"right";p.push({title:"操作",dataIndex:"operation",fixed:e,render(o){const m=t.operations(o.record).filter(u=>u.visible!==!1);return h(B,{onResize:g},()=>h(z,{operations:m}))}})}const r=c(!1),s=c([]),a=I(p);w(s,e=>{if(t.operations&&D(e)&&e.length>0){let o=!1;for(const m of e){const u=t.operations(m).filter(b=>b.visible!==!1);if(u&&u.length>0){o=!0;break}}a.changeColumnVisibleByDataIndex("operation",o)}});let i=80;function g(e){const{width:o}=e.contentRect;i=Math.max(o,i),a.updateColumnByDataIndex("operation","width",i+33)}const n=c(C());function v(e){return n.value.current=e,l()}function x(e){return n.value.current=1,n.value.pageSize=e,l()}f(t.pagination)&&(n.value={...C(),...t.pagination});function l(){return r.value=!0,t.fetch({pageNum:n.value.current,pageSize:n.value.pageSize,columnKeys:[...a.columnKeys.value]}).then(e=>{f(e)?(s.value=Array.isArray(e.records)?e.records:[],n.value.total=e.total??0):console.warn("useTablePage请求返回结果数据异常!",e)}).finally(()=>{r.value=!1})}function y(){return l()}function d(){return n.value.current=1,l()}return t.immediate===!0&&d(),{tableData:s,loading:r,loadTableData:d,refreshData:y,pagination:n,tableInstance:a.tableInstance,originColumns:a.originColumns,columns:a.columns,columnKeys:a.columnKeys,resetColumns:a.resetColumns,changeColumnVisibleByDataIndex:a.changeColumnVisibleByDataIndex,updateColumnByDataIndex:a.updateColumnByDataIndex,replaceColumnByDataIndex:a.replaceColumnByDataIndex,tableConfig:P({loading:r,data:s,columns:a.columns,ref:a.ref,pagination:n,onPageChange:v,onPageSizeChange:x,onColumnResize(e,o){a.updateColumnByDataIndex(e,"width",o),a.updateColumnsWidth()}})}}export{A as u};
